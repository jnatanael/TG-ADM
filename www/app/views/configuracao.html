<div id="breadcrumbs-wrapper">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <h5 class="breadcrumbs-title">{{message}}</h5>
                <ol class="breadcrumbs">
                    <li><a href="#/">Dashboard</a></li>
                    <li class="active">{{message}}</li>
                </ol>
            </div>
        </div>
    </div>
</div>
<!--breadcrumbs end-->

<!--start container-->
<div class="container">
    <div class="section">
        <p class="caption">Preencha com as informações da empresa.</p>
        <div class="divider"></div>
        <form enctype="multipart/form-data">
            <div class="row">
                <img src="{{data.logotipo}}" alt="{{data.nome_fantasia}}" class="responsive-img">
                <div class="file-field input-field col s12">                    
                    <div class="btn">
                        <span>Logotipo da Empresa</span>
                        <input type="file" id="logotipo">
                    </div>
                    <div class="file-path-wrapper">
                        <input class="file-path validate" type="text">
                    </div>
                </div>
                <div class="input-field col s12">
                    <input id="razao_social" name="razao_social" type="text" class="validate" value="{{data.razao_social}}">
                    <label for="razao_social">Razão Social</label>
                </div>
            </div>
            <div class="row">
                <div class="input-field col s12">
                    <input id="nome_fantasia" name="nome_fantasia" type="text" class="validate" value="{{data.nome_fantasia}}">
                    <label for="nome_fantasia">Nome Fantasia</label>
                </div>
            </div>
            <div class="row">
                <div class="input-field col s6">
                    <input id="cnpj" name="cnpj" type="text" class="validate" value="{{data.cnpj}}">
                    <label for="cnpj">CNPJ</label>
                </div>
                <div class="input-field col s6">
                    <input id="inscricao_estadual" type="text" class="validate" value="{{data.inscricao_estadual}}">
                    <label for="inscricao_estadual">Inscrição Estadual</label>
                </div>
            </div>
            <div class="row">
                <div class="input-field col s6">
                    <input id="telefone" name="telefone" type="tel" class="validate" value="{{data.telefone}}">
                    <label for="telefone">Telefone</label>
                </div>
                <div class="input-field col s6">
                    <input id="email" name="email" type="email" class="validate" value="{{data.email}}">
                    <label for="email">E-mail</label>
                </div>
            </div>
            <div class="row">
                <div class="input-field col s4">
                    <input id="cep" name="cep" type="text" class="validate"  value="{{data.cep}}">
                    <label for="cep">CEP</label>
                </div>
                <div class="input-field col s4">
                    <input id="cidade" name="cidade" type="text" class="validate" value="{{data.cidade}}">
                    <label for="cidade">Cidade</label>
                </div>
                <div class="input-field col s4">
                    <select name="estado" id="estado">
                        <option value="" disabled selected>Selecione o Estado</option>
                        <option value="AC">Acre</option>
                        <option value="AL">Alagoas</option>
                        <option value="AP">Amapá</option>
                        <option value="AM">Amazonas</option>
                        <option value="BA">Bahia</option>
                        <option value="CE">Ceará</option>
                        <option value="DF">Distrito Federal</option>
                        <option value="ES">Espírito Santo</option>
                        <option value="GO">Goiás</option>
                        <option value="MA">Maranhão</option>
                        <option value="MT">Mato Grosso</option>
                        <option value="MS">Mato Grosso do Sul</option>
                        <option value="MG">Minas Gerais</option>
                        <option value="PA">Pará</option>
                        <option value="PB">Paraíba</option>
                        <option value="PR">Paraná</option>
                        <option value="PE">Pernambuco</option>
                        <option value="PI">Piauí</option>
                        <option value="RJ">Rio de Janeiro</option>
                        <option value="RN">Rio Grande do Norte</option>
                        <option value="RS">Rio Grande do Sul</option>
                        <option value="RO">Rondônia</option>
                        <option value="RR">Roraima</option>
                        <option value="SC">Santa Catarina</option>
                        <option value="SP">São Paulo</option>
                        <option value="SE">Sergipe</option>
                        <option value="TO">Tocantins</option>
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="input-field col s12">
                    <input id="rua" name="rua" type="text" class="validate" value="{{data.rua}}">
                    <label for="rua">Rua</label>
                </div>
            </div>
            <div class="row">
                <div class="input-field col s2">
                    <input id="numero" name="numero" type="text" class="validate" value="{{data.numero}}">
                    <label for="numero">Número</label>
                </div>
                <div class="input-field col s3">
                    <input id="complemento" name="complemento" type="text" class="validate"  value="{{data.complemento}}">
                    <label for="complemento">Complemento</label>
                </div>
                <div class="input-field col s7">
                    <input id="bairro" name="bairro" type="text" class="validate" value="{{data.bairro}}">
                    <label for="bairro">Bairro</label>
                </div>
            </div>
            <div class="row">
                <div class="input-field col s12">
                    <button class="btn green waves-effect waves-light left" type="submit" name="action" onclick="salvar()">Salvar
                        <i class="mdi-content-send right"></i>
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>
<!--end container-->

<script type="text/javascript">

    $(document).ready(function () {
        $('select').material_select();
        Materialize.updateTextFields();
    });


    function salvar() {
        swal({title: "Salvando!",
            text: "Aguarde...",
            timer: 2000,
            showConfirmButton: false
        });
        var razao_social = $('#razao_social').val();
        var nome_fantasia = $('#nome_fantasia').val();
        var inscricao_estadual = $('#inscricao_estadual').val();
        var cnpj = $('#cnpj').val();
        var telefone = $('#telefone').val();
        var email = $('#email').val();
        var cep = $('#cep').val();
        var cidade = $('#cidade').val();
        var estado = $('#estado').val();
        var rua = $('#rua').val();
        var numero = $('#numero').val();
        var complemento = $('#complemento').val();
        var bairro = $('#bairro').val();
        var logotipo = document.getElementById("logotipo").files[0];

        var storageRef = firebase.storage().ref();


// Upload file and metadata to the object 'images/mountains.jpg'
        var uploadTask = storageRef.child('config/' + logotipo.name).put(logotipo);

// Listen for state changes, errors, and completion of the upload.
        uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED, // or 'state_changed'
                function (snapshot) {
                    // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded
                    var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    console.log('Upload is ' + progress + '% done');
                    switch (snapshot.state) {
                        case firebase.storage.TaskState.PAUSED: // or 'paused'
                            console.log('Upload is paused');
                            break;
                        case firebase.storage.TaskState.RUNNING: // or 'running'
                            console.log('Upload is running');
                            break;
                    }
                }, function (error) {
            switch (error.code) {
                case 'storage/unauthorized':
                    // User doesn't have permission to access the object
                    break;

                case 'storage/canceled':
                    // User canceled the upload
                    break;
                case 'storage/unknown':
                    // Unknown error occurred, inspect error.serverResponse
                    break;
            }
        }, function () {
            // Upload completed successfully, now we can get the download URL
            var downloadURL = uploadTask.snapshot.downloadURL;

            firebase.database().ref('configuracao/').set({
                razao_social: razao_social,
                nome_fantasia: nome_fantasia,
                inscricao_estadual: inscricao_estadual,
                cnpj: cnpj,
                telefone: telefone,
                email: email,
                cep: cep,
                cidade: cidade,
                estado: estado,
                rua: rua,
                numero: numero,
                complemento: complemento,
                bairro: bairro,
                logotipo: downloadURL
            });
            swal("Configurações salvas com sucesso!", "", "success");
        });


    }
</script>
